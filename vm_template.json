{
   "contentVersion":"1.0.0.0",
   "resources":[
      {
         "properties":{
            "hardwareProfile":{
               "vmSize":"Basic_A1"
            },
            "storageProfile":{
               "imageReference":{
                  "publisher":"Canonical",
                  "offer":"UbuntuServer",
                  "sku":"16.04-LTS",
                  "version":"latest"
               },
               "osDisk":{
                  "createOption":"FromImage",
                  "managedDisk":{
                     "storageAccountType":"Standard_LRS"
                  }
               },
               "dataDisks":[]
            },
            "networkProfile":{
               "networkInterfaces":[
                  {
                     "id":"[resourceId('Microsoft.Network/networkInterfaces/','server_nic')]"
                  }
               ]
            },
            "osProfile":{
               "adminUsername":"adminuser",
               "adminPassword":"_ozu%X0qtn750feS^",
               "computerName":"server",
               "linuxConfiguration":{
                  "disablePasswordAuthentication":false
               }
            }
         },
         "type":"Microsoft.Compute/virtualMachines",
         "location":"[resourceGroup().location]",
         "name":"server",
         "apiVersion":"2019-12-01",
         "dependsOn":[]
      },
      {
         "properties":{
            "hardwareProfile":{
               "vmSize":"Basic_A1"
            },
            "storageProfile":{
               "imageReference":{
                  "publisher":"Canonical",
                  "offer":"UbuntuServer",
                  "sku":"16.04-LTS",
                  "version":"latest"
               },
               "osDisk":{
                  "createOption":"FromImage",
                  "managedDisk":{
                     "storageAccountType":"Standard_LRS"
                  }
               },
               "dataDisks":[]
            },
            "networkProfile":{
               "networkInterfaces":[
                  {
                     "id":"[resourceId('Microsoft.Network/networkInterfaces/','client_nic')]"
                  }
               ]
            },
            "osProfile":{
               "adminUsername":"adminuser",
               "adminPassword":"_ozu%X0qtn750feS^",
               "computerName":"client",
               "linuxConfiguration":{
                  "disablePasswordAuthentication":false
               }
            }
         },
         "type":"Microsoft.Compute/virtualMachines",
         "location":"[resourceGroup().location]",
         "name":"client",
         "apiVersion":"2019-12-01",
         "dependsOn":[]
      },
      {
         "properties":{
            "publisher":"Microsoft.Azure.Extensions",
            "type":"CustomScript",
            "autoUpgradeMinorVersion":true,
            "typeHandlerVersion":"2.0",
            "protectedSettings":{
               "commandToExecute":"wget https://google.com",
               "fileUris":[]
            }
         },
         "type":"Microsoft.Compute/virtualMachines/extensions",
         "dependsOn":[
            "[resourceId('Microsoft.Compute/virtualMachines/','server')]"
         ],
         "location":"[resourceGroup().location]",
         "name":"server/CustomScriptForLinux",
         "apiVersion":"2017-12-01"
      },
      {
         "properties":{
            "publisher":"Microsoft.Azure.Extensions",
            "type":"CustomScript",
            "autoUpgradeMinorVersion":true,
            "typeHandlerVersion":"2.0",
            "protectedSettings":{
               "commandToExecute":"while true; do ping -c1 server.azure.ticket.com && break; done",
               "fileUris":[]
            }
         },
         "type":"Microsoft.Compute/virtualMachines/extensions",
         "dependsOn":[
            "[resourceId('Microsoft.Compute/virtualMachines/','client')]"
         ],
         "location":"[resourceGroup().location]",
         "name":"client/CustomScriptForLinux",
         "apiVersion":"2017-12-01"
      },
      {
         "properties":{
            "ttl":3600,
            "aRecords":[
               {
                  "ipv4Address":"[reference(resourceId('Microsoft.Network/networkInterfaces/','server_nic'), '2017-10-01').ipConfigurations[0].properties.privateIPAddress]"
               }
            ]
         },
         "type":"Microsoft.Network/privateDnsZones/A",
         "location":"global",
         "dependsOn":[],
         "name":"azure.ticket.com/server",
         "apiVersion":"2018-09-01"
      },
      {
         "properties":{
            "ttl":3600,
            "aRecords":[
               {
                  "ipv4Address":"[reference(resourceId('Microsoft.Network/networkInterfaces/','client_nic'), '2017-10-01').ipConfigurations[0].properties.privateIPAddress]"
               }
            ]
         },
         "type":"Microsoft.Network/privateDnsZones/A",
         "location":"global",
         "dependsOn":[],
         "name":"azure.ticket.com/client",
         "apiVersion":"2018-09-01"
      }
   ],
   "$schema":"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json"
}
